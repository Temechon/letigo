{"version":3,"sources":["../../js/Building.js"],"names":[],"mappings":"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","file":"Building.js","sourcesContent":["/**\r\n * A building is a structure that can be bought by the player\r\n */\r\nclass Building extends GameObject{\r\n\r\n    constructor(game, position) {\r\n        super(game);\r\n\r\n        this.position = position;\r\n\r\n        // The old price of this building (to know if the price is rising of decreasing)\r\n        this._oldPrice = 0;\r\n\r\n        // The price of this building\r\n        this.price = 0;\r\n\r\n        // debug\r\n        this.addChildren(BABYLON.MeshBuilder.CreateBox('', {width:0.5, height:1, depth:0.5}, this.getScene()));\r\n\r\n        this.setReady();\r\n\r\n\r\n        // Arrows\r\n        this.arrowUpTag = document.createElement('i');\r\n        this.arrowUpTag.className = 'fa fa-arrow-up';\r\n\r\n        this.arrowDownTag = document.createElement('i');\r\n        this.arrowDownTag.className = 'fa fa-arrow-down';\r\n\r\n        // Price label\r\n        this.priceTag = document.createElement('div');\r\n        this.priceTag.className = 'priceTag';\r\n        this.priceTag.innerHTML = \"99999\";\r\n        this.priceTag.appendChild(this.arrowUpTag);\r\n    }\r\n\r\n    spawn(callback) {\r\n        let duration = 1000;\r\n        let fps = 20;\r\n        let quarter = duration*fps*0.001/4;\r\n\r\n        if (this.animations.length == 0) {\r\n\r\n            // Position animation\r\n            let position = new BABYLON.Animation(\"\", \"position.y\", fps, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);\r\n            position.setKeys([\r\n                { frame: 0, value: 0 },\r\n                { frame: quarter, value: this.position.y+1 },\r\n                { frame: quarter*4, value: this.position.y }\r\n            ]);\r\n            let e = new BABYLON.CubicEase();\r\n            e.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);\r\n            position.setEasingFunction(e);\r\n            this.animations.push(position);\r\n\r\n            // Scaling\r\n            let scaling = new BABYLON.Animation(\"\", \"scaling\", fps, BABYLON.Animation.ANIMATIONTYPE_VECTOR3, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);\r\n            scaling.setKeys([\r\n                { frame: 0, value: BABYLON.Vector3.Zero() },\r\n                { frame: quarter*3, value: new BABYLON.Vector3(1.2,1.2,1.2) },\r\n                { frame: quarter*4, value: new BABYLON.Vector3(1,1,1) }\r\n            ]);\r\n            let f = new BABYLON.ElasticEase();\r\n            f.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEOUT);\r\n            scaling.setEasingFunction(f);\r\n            this.animations.push(scaling);\r\n\r\n            // Rotation\r\n            let rotation = new BABYLON.Animation(\"\", \"rotation.y\", fps, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);\r\n            rotation.setKeys([\r\n                { frame: 0, value: 0 },\r\n                { frame: quarter*4, value: Math.PI*2 }\r\n            ]);\r\n            rotation.setEasingFunction(e);\r\n            this.animations.push(rotation);\r\n        }\r\n\r\n        this.getScene().beginAnimation(this, 0, duration, false, 1, () => {\r\n            this.displayPrice();\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns screen coordinates of the building\r\n     */\r\n    _project() {\r\n        //this.scene.updateTransformMatrix();\r\n        var tmpPos = this.position.clone();\r\n        return BABYLON.Vector3.Project(\r\n            tmpPos,\r\n            BABYLON.Matrix.Identity(),\r\n            this.getScene().getTransformMatrix(),\r\n            this.getScene().activeCamera.viewport.toGlobal(this.getScene().getEngine())\r\n        );\r\n    };\r\n\r\n    displayPrice() {\r\n        document.getElementsByTagName('body')[0].appendChild(this.priceTag);\r\n        var p = this._project();\r\n\r\n        p.y += this.priceTag.clientHeight / 2;\r\n        p.x -= this.priceTag.clientWidth / 2;\r\n\r\n        this.priceTag.style.top = p.y + \"px\";\r\n        this.priceTag.style.left = p.x + \"px\";\r\n    }\r\n\r\n    updatePrice() {\r\n        this.priceTag.innerHTML = this.price;\r\n    }\r\n\r\n\r\n\r\n}"]}