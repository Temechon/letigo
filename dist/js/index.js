"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},GameObject=function(a){function b(a){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,"__go__",a.scene),this.game=a,this.isVisible=!1,this._children=[],BABYLON.Tags.AddTagsTo(this,"__go__")}return _inherits(b,a),_createClass(b,[{key:"setReady",value:function(){this.computeWorldMatrix(!0),this._children.forEach(function(a){a.computeWorldMatrix(!0)})}},{key:"addChildren",value:function(a){a.parent=this,this._children.push(a)}},{key:"isCollidingWith",value:function(a){if(BABYLON.Tags.MatchesQuery(a,"__go__")){for(var b=0;b<this._children.length;b++)for(var c=0;c<a._children.length;c++)if(this._children[b].intersectsMesh(a._children[c],!0))return!0}else for(b=0;b<this._children.length;b++)if(this._children[b].intersectsMesh(a,!0))return!0}}]),b}(BABYLON.Mesh),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},Building=function(a){function b(a,c){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a),this.position=c,this.addChildren(BABYLON.MeshBuilder.CreateBox("",{width:.5,height:1,depth:.5},this.getScene())),this.setReady()}return _inherits(b,a),_createClass(b,[{key:"spawn",value:function(a){var b=1e3,c=20,d=b*c*.001/4;if(0==this.animations.length){var e=new BABYLON.Animation("","position.y",c,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);e.setKeys([{frame:0,value:0},{frame:d,value:this.position.y+1},{frame:4*d,value:this.position.y}]);var f=new BABYLON.CubicEase;f.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),e.setEasingFunction(f),this.animations.push(e);var g=new BABYLON.Animation("","scaling",c,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);g.setKeys([{frame:0,value:BABYLON.Vector3.Zero()},{frame:3*d,value:new BABYLON.Vector3(1.2,1.2,1.2)},{frame:4*d,value:new BABYLON.Vector3(1,1,1)}]);var h=new BABYLON.ElasticEase;h.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEOUT),g.setEasingFunction(h),this.animations.push(g);var i=new BABYLON.Animation("","rotation.y",c,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);i.setKeys([{frame:0,value:0},{frame:4*d,value:2*Math.PI}]),i.setEasingFunction(f),this.animations.push(i)}this.getScene().beginAnimation(this,0,b,!1,1,a)}}]),b}(GameObject),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},Cell=function(a){function b(a){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a),this.position=BABYLON.Vector3.Zero(),this.size=4,this.buildings=[],this.positions=null,this.updatePosition(),this.isVisible=!0;var c=BABYLON.VertexData.CreateGround({width:this.size,height:this.size,subdivisions:1});c.applyToMesh(this,!1),this.material=new BABYLON.StandardMaterial("",this.getScene())}return _inherits(b,a),_createClass(b,[{key:"updatePosition",value:function(){var a=arguments.length<=0||void 0===arguments[0]?BABYLON.Vector3.Zero():arguments[0];this.position=a;var b=this.size/4;this.positions=[new BABYLON.Vector3(this.position.x-b,this.position.y,this.position.z-b),new BABYLON.Vector3(this.position.x-b,this.position.y,this.position.z+b),new BABYLON.Vector3(this.position.x+b,this.position.y,this.position.z-b),new BABYLON.Vector3(this.position.x+b,this.position.y,this.position.z+b)]}}]),b}(GameObject),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.addEventListener("DOMContentLoaded",function(){new Game("game-canvas")});var Game=function(){function a(b){var c=this;_classCallCheck(this,a);var d=document.getElementById(b);this.engine=new BABYLON.Engine(d,!1,null,!1),this.assets=[],this.scene=null,this.availablePositions=[],this.takenPositions=[],window.addEventListener("resize",function(){c.engine.resize()}),this.run()}return _createClass(a,[{key:"_initScene",value:function(){var a=new BABYLON.Scene(this.engine),b=new BABYLON.FreeCamera("cam",new BABYLON.Vector3(9.4,15,-14),a);b.rotation.x=.5,b.attachControl(this.engine.getRenderingCanvas());var c=new BABYLON.HemisphericLight("hemi",new BABYLON.Vector3(0,1,0),a);return c.intensity=.9,a}},{key:"run",value:function(){var a=this;this.scene=this._initScene();var b=new BABYLON.AssetsManager(this.scene);b.onFinish=function(){a._initGame(),a.isReady=!0,a.engine.runRenderLoop(function(){a.scene.render()})},b.load()}},{key:"_initGame",value:function(){var a=this;window.addEventListener("keydown",function(b){32==b.keyCode&&(a.scene.debugLayer._enabled?a.scene.debugLayer.hide():a.scene.debugLayer.show())});for(var b=0;5>b;b++)for(var c=0;5>c;c++){var d,e=new Cell(this);e.updatePosition(new BABYLON.Vector3(5*b,0,5*c)),(d=this.availablePositions).push.apply(d,_toConsumableArray(e.positions))}setInterval(function(){a.build(a.getRandomPosition())},200)}},{key:"_randomNumber",value:function(a,b){if(a===b)return a;var c=Math.random();return Math.floor(c*(b-a)+a)}},{key:"getRandomPosition",value:function(){var a=this._randomNumber(0,this.availablePositions.length);console.log(a);var b=this.availablePositions.splice(a,1)[0];return this.takenPositions.push(b),b}},{key:"build",value:function(a){if(a){var b=new Building(this,a);b.spawn()}}}]),a}();